<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>愛的86400 - 互動式小說原型</title>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 設定樣式與字型 -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Noto+Serif+TC:wght@400;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        .serif {
            font-family: 'Noto Serif TC', serif;
        }
        /* 自定義捲軸 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- 圖示元件定義 (SVG) ---
        const IconBase = ({ size = 24, className = "", children }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Play = (props) => <IconBase {...props}><polygon points="5 3 19 12 5 21 5 3"></polygon></IconBase>;
        const Pause = (props) => <IconBase {...props}><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></IconBase>;
        const SkipBack = (props) => <IconBase {...props}><polygon points="19 20 9 12 19 4 19 20"></polygon><line x1="5" y1="19" x2="5" y2="5"></line></IconBase>;
        const SkipForward = (props) => <IconBase {...props}><polygon points="5 4 15 12 5 20 5 4"></polygon><line x1="19" y1="5" x2="19" y2="19"></line></IconBase>;
        const Clock = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></IconBase>;
        const User = (props) => <IconBase {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></IconBase>;
        const ChefHat = (props) => <IconBase {...props}><path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"></path><line x1="6" y1="17" x2="18" y2="17"></line></IconBase>;
        const Wine = (props) => <IconBase {...props}><path d="M8 22h8"></path><path d="M7 10h10"></path><path d="M12 15v7"></path><path d="M12 15a5 5 0 0 0 5-5c0-2-.5-4-2-8H9c-1.5 4-2 6-2 8a5 5 0 0 0 5 5Z"></path></IconBase>;
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></IconBase>;
        const Sparkles = (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M9 5H5"></path><path d="M3 7V3"></path></IconBase>;
        const Flame = (props) => <IconBase {...props}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3.3-1.09.91-2.1 1.63-2.98.5 1.76.97 3.65.87 5.78Z"></path></IconBase>;
        const MessageCircle = (props) => <IconBase {...props}><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5Z"></path></IconBase>;
        const Volume2 = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></IconBase>;
        const VolumeX = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></IconBase>;
        const MapIcon = (props) => <IconBase {...props}><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></IconBase>;

        // --- 劇本資料結構：五人晚餐修羅場 ---
        const scriptData = {
          meta: {
            title: "愛的86400-實驗計畫1-愛的修羅場",
            duration: 300
          },
          characters: [
            // 增加 mapPos: {top: %, left: %} 定義在地圖上的相對位置
            { id: 'leo', name: 'Leo', role: '高冷花心男', color: 'bg-indigo-100 border-indigo-500', icon: <User />, keyword: 'man,suit', lockId: 101, imgFile: '001.jpg', mapPos: { top: '55%', left: '45%' } },
            { id: 'claire', name: 'Claire', role: '御姐女友', color: 'bg-purple-100 border-purple-600', icon: <Flame />, keyword: 'woman,fashion,portrait', lockId: 205, imgFile: '002.jpg', mapPos: { top: '75%', left: '30%' } },
            { id: 'mina', name: 'Mina', role: '蘿莉女友', color: 'bg-pink-100 border-pink-400', icon: <Sparkles />, keyword: 'girl,cute,portrait', lockId: 308, imgFile: '003.jpg', mapPos: { top: '40%', left: '45%' } },
            { id: 'vicky', name: 'Vicky', role: '性感服務生', color: 'bg-red-100 border-red-500', icon: <Wine />, keyword: 'woman,waitress', lockId: 412, imgFile: '004.jpg', mapPos: { top: '60%', left: '65%' } },
            { id: 'gordon', name: 'Gordon', role: '暴躁主廚', color: 'bg-stone-200 border-stone-600', icon: <ChefHat />, keyword: 'chef,man,portrait', lockId: 523, imgFile: '005.jpg', mapPos: { top: '20%', left: '80%' } }
          ],
          timeline: [
            // ... (劇本內容保持不變，為節省篇幅省略部分重複內容，邏輯與之前相同) ...
            // --- 第一分鐘 (0-60s) ---
            {
              time: 0,
              leo: { type: 'thought', text: "這間餐廳燈光夠暗，應該很安全。Mina 說想吃牛排很久了。", visual: "切著盤中的牛排，眼神習慣性地掃描餐廳門口。" },
              mina: { type: 'dialogue', text: "Leo 哥哥，這家的牛排好好吃喔～我們要不要拍照？", visual: "拿著手機，透過美顏濾鏡看著 Leo 的臉。" },
              claire: { type: 'thought', text: "剛下飛機真累。這家餐廳評價不錯，希望能安靜吃頓飯。", visual: "推開餐廳大門，服務生正在帶位，視線掃過昏暗的大廳。" },
              vicky: { type: 'thought', text: "3號桌那個帥哥帶的妹子跟上週不一樣欸。有意思。", visual: "拿著紅酒瓶，站在角落觀察場內動向。" },
              gordon: { type: 'action', text: "（對著內場大吼）羊排佐醬呢！你是要讓客人等到聖誕節嗎！", visual: "盯著出餐口的單據，煙霧繚繞的廚房視角。" }
            },
            {
              time: 10,
              leo: { type: 'dialogue', text: "拍照先不用了，這裡光線不好。妳快趁熱吃。", visual: "看到門口進來一個穿風衣的高挑身影，心跳漏了一拍。那是 Claire 的香水味嗎？" },
              mina: { type: 'thought', text: "幹嘛這麼冷淡... 難道旁邊有美女？", visual: "放下手機，鼓起臉頰，視線往 Leo 看的方向飄去。" },
              claire: { type: 'dialogue', text: "一位，給我角落的位置。還有，給我一杯馬丁尼。", visual: "將大衣遞給服務生，視線無意間掃過 3 號桌的背影。" },
              vicky: { type: 'dialogue', text: "好的，小姐這邊請...（這女人氣場好強，好像在哪見過？）", visual: "引導 Claire 走向 5 號桌（就在 3 號桌斜後方）。" },
              gordon: { type: 'thought', text: "外場在搞什麼？3號桌的紅酒還沒上？Vicky！", visual: "大力按著出餐鈴。叮！叮！叮！" }
            },
            {
              time: 20,
              leo: { type: 'thought', text: "幹！那是 Claire！她不是去米蘭出差嗎？為什麼會坐在我正後方？", visual: "背脊發涼，低頭假裝切肉，完全不敢回頭。" },
              mina: { type: 'dialogue', text: "Leo 哥哥，你流好多汗喔，很熱嗎？", visual: "伸出手想幫 Leo 擦額頭。" },
              claire: { type: 'thought', text: "前面那桌的男人背影好像 Leo。不可能吧，他說他在加班。", visual: "坐下，優雅地打開菜單，眼神卻透過鏡子的反射觀察 3 號桌。" },
              vicky: { type: 'action', text: "（走到 3 號桌倒酒，故意彎腰）", visual: "靠近 Leo 的耳邊倒酒，視線偷瞄剛坐下的 Claire。" },
              gordon: { type: 'thought', text: "那個男的看起來快心臟病發了。現在的年輕人身體真差。", visual: "透過出餐口的縫隙看著外場的一齣好戲。" }
            },
            {
              time: 30,
              leo: { type: 'dialogue', text: "別！別碰我... 我沒事，我去一下洗手間！", visual: "Mina 的手伸過來像炸彈一樣。猛地站起來，餐巾掉在地上。" },
              mina: { type: 'thought', text: "他躲我？他竟然躲我？那個服務生剛剛是不是用胸部撞他？", visual: "錯愕地看著 Leo 慌張的背影，轉頭怒瞪 Vicky。" },
              claire: { type: 'thought', text: "這聲音... 就是 Leo。而且這反應... 呵，有鬼。", visual: "透過鏡子看到 Leo 站起來，嘴角勾起一抹冷笑，合上菜單。" },
              vicky: { type: 'dialogue', text: "先生，您的紅酒灑出來了呢。需要幫忙擦拭嗎？", visual: "拿著紙巾擋住 Leo 的去路，故意拖延時間。" },
              gordon: { type: 'action', text: "（把平底鍋摔在爐台上）那個服務生在調情嗎？我的牛排要冷掉了！", visual: "火冒三丈，準備衝出廚房。" }
            },
            {
              time: 45,
              leo: { type: 'thought', text: "Vicky 妳這時候別鬧！Claire 走過來了！死定了死定了！", visual: "視線餘光看到紫色裙擺逼近，像死神一樣。" },
              mina: { type: 'dialogue', text: "喂！妳離我男朋友遠一點！", visual: "站起來指著 Vicky，完全沒注意到身後逼近的 Claire。" },
              claire: { type: 'dialogue', text: "喔？男朋友？真巧，我也有個男朋友長得很像這位先生。", visual: "走到 3 號桌旁，雙手抱胸，居高臨下地看著兩人。" },
              vicky: { type: 'thought', text: "Bingo！修羅場達成。這比領小費還好玩。", visual: "退後一步，露出一抹看好戲的微笑。" },
              gordon: { type: 'dialogue', text: "全部給我讓開！上菜！！！", visual: "端著滾燙的鐵板衝出來，強行切入戰場中央。" }
            },
            {
              time: 60,
              leo: { type: 'thought', text: "主廚我愛你！這是我這輩子見過最美的牛排！", visual: "趁著主廚擋住視線的混亂瞬間，看著唯一的逃生出口（後門）。" },
              mina: { type: 'thought', text: "這老女人是誰？氣場好恐怖...", visual: "被 Claire 的氣勢嚇到，往後縮了一下。" },
              claire: { type: 'thought', text: "想跑？門都沒有。", visual: "無視主廚的鐵板，伸手直接抓住了 Leo 的衣領。" },
              vicky: { type: 'thought', text: "要打起來了嗎？我要不要報警？還是先錄影？", visual: "手已經摸到了口袋裡的手機。" },
              gordon: { type: 'thought', text: "為什麼沒有人在乎我的威靈頓牛排！這群野蠻人！", visual: "看著精美的擺盤即將被毀，心中在淌血。" }
            },

            // --- 第二分鐘 (61-120s) ---
            {
              time: 75,
              leo: { type: 'dialogue', text: "Claire 妳聽我解釋！這是我... 我遠房表妹 Mina！", visual: "被 Claire 揪著衣領，眼神飄忽不定，冷汗直流。" },
              mina: { type: 'dialogue', text: "表妹？Leo 哥哥你說什麼？我們五分鐘前還在接吻欸！", visual: "震驚地張大嘴巴，手機掉在桌上。" },
              claire: { type: 'dialogue', text: "表妹？呵呵，你們家族的表親互動真是前衛啊。", visual: "冷笑一聲，加重了手上的力道，眼神像刀子一樣刮過 Leo 的臉。" },
              vicky: { type: 'thought', text: "噗哧，表妹梗？這年頭還有人用這招？爛透了。", visual: "忍不住笑出聲，調整手機角度，確保拍到每個人的表情。" },
              gordon: { type: 'dialogue', text: "我不管你們是表兄妹還是亂倫！這塊牛排的酥皮正在軟化！快吃！", visual: "憤怒地指著桌上冒著熱氣的威靈頓牛排，臉漲得通紅。" }
            },
            {
              time: 90,
              leo: { type: 'dialogue', text: "對！主廚說得對！我們先吃牛排！Mina 妳不是最愛吃牛排嗎？", visual: "像抓到救命稻草一樣指著牛排，試圖轉移話題。" },
              mina: { type: 'thought', text: "他真的把我當白痴耍... 虧我還為了今晚買了新裙子...", visual: "眼眶開始泛紅，淚水在打轉，看著那塊該死的牛排。" },
              claire: { type: 'action', text: "（放開 Leo，優雅地坐下）", visual: "拍了拍手，彷彿碰了什麼髒東西，直接坐在 Leo 原本的位置上。" },
              vicky: { type: 'dialogue', text: "哎呀，這位妹妹要哭囉～ 需要紙巾嗎？還是需要卸妝油？", visual: "遞上一張紙巾，語氣充滿了看熱鬧的挑釁。" },
              gordon: { type: 'thought', text: "終於坐下了。這群野蠻人根本不懂欣賞藝術。", visual: "鬆了一口氣，但手還是在發抖，隨時準備爆發。" }
            },
            {
              time: 105,
              leo: { type: 'thought', text: "完了，Mina 要哭了，Claire 要殺人了，Vicky 在錄影... 我的人生結束了。", visual: "夾在兩個女人中間，看著桌上的刀叉，思考哪一支可以用來防身。" },
              mina: { type: 'dialogue', text: "你這個大騙子！誰是你表妹！", visual: "抓起桌上的水杯，手在劇烈顫抖。" },
              claire: { type: 'dialogue', text: "省點力氣吧小妹妹，為了這種男人弄花妝容不值得。", visual: "拿起紅酒杯輕啜一口，連正眼都沒看 Mina 一眼。" },
              vicky: { type: 'thought', text: "水杯！水杯拿起來了！高潮要來了！", visual: "興奮地屏住呼吸，手指按在錄影鍵上。" },
              gordon: { type: 'action', text: "（正在幫鄰桌磨胡椒，突然有不好的預感）", visual: "轉頭看向這桌，眼神充滿驚恐。" }
            },
            {
              time: 120,
              leo: { type: 'action', text: "（閉上眼睛準備迎接衝擊）", visual: "看到 Mina 手中的水杯潑過來，本能地縮起脖子。" },
              mina: { type: 'action', text: "（用力潑出水杯裡的水）去死吧！", visual: "將整杯冰水狠狠潑向 Leo... 的方向，但 Leo 躲開了。" },
              claire: { type: 'action', text: "（優雅地拿起餐巾擋住）", visual: "反應極快地擋住了飛濺的水珠，但紅酒還是被波及到了。" },
              vicky: { type: 'dialogue', text: "哇喔！Critical Hit！水屬性攻擊！", visual: "差點為了拍特寫而滑倒，心裡暗爽。" },
              gordon: { type: 'dialogue', text: "不！！！！我的特製紅酒醬汁！！！！", visual: "看著被水潑到的牛排盤，發出了靈魂深處的慘叫。" }
            },

            // --- 第三分鐘 (121-180s) ---
            {
              time: 135,
              leo: { type: 'dialogue', text: "Mina！妳瘋了嗎？這套西裝要五萬塊！妳賠得起嗎？", visual: "跳起來拍打身上的水漬，完全無視狼狽的兩個女人，只顧著檢查西裝。" },
              mina: { type: 'dialogue', text: "你... 你現在只在乎你的西裝？那我算什麼？", visual: "難以置信地看著眼前的男人，眼淚終於奪眶而出，妝全花了。" },
              claire: { type: 'thought', text: "五萬？呵，那還是刷我的副卡買的。", visual: "冷眼看著 Leo 慌亂的樣子，慢條斯理地用紙巾擦去手背上的水珠。" },
              vicky: { type: 'dialogue', text: "各位觀眾！渣男語錄更新囉！『女友不如西裝』！", visual: "將手機鏡頭懟到 Leo 臉上，興奮地當場解說。" },
              gordon: { type: 'action', text: "（抄起一根巨大的胡椒研磨棒）", visual: "從鄰桌手中搶過半個人高的胡椒罐，像拿著狼牙棒一樣衝過來。" }
            },
            {
              time: 150,
              leo: { type: 'dialogue', text: "Claire，我們回家吧。這瘋女人是跟蹤狂！我根本不熟！", visual: "試圖拉 Claire 的手，卻被無情甩開。" },
              mina: { type: 'action', text: "（從包包掏出一串鑰匙）跟蹤狂？這不是你家鑰匙嗎！", visual: "憤怒地將一串掛著小熊吊飾的鑰匙摔在桌上，發出清脆的聲響。" },
              claire: { type: 'dialogue', text: "喔？你不是說備用鑰匙掉進水溝了嗎？", visual: "撿起桌上的鑰匙，眼神瞬間降至冰點，嘴角卻勾起可怕的笑容。" },
              vicky: { type: 'thought', text: "實錘了！這證據太硬了！這男人沒救了。", visual: "給桌上的鑰匙來個大特寫。" },
              gordon: { type: 'thought', text: "他們把我的餐廳當成什麼了？鄉土劇片場嗎？", visual: "氣喘吁吁地推開擋路的服務生，殺氣騰騰。" }
            },
            {
              time: 165,
              leo: { type: 'thought', text: "該死... 忘記拿回來了... 現在說這是給鐘點工的鑰匙還來得及嗎？", visual: "看著那串鑰匙，大腦一片空白，嘴唇發白。" },
              mina: { type: 'action', text: "（掩面痛哭）我真是瞎了眼...", visual: "蹲在地上大哭，引來全餐廳的側目。" },
              claire: { type: 'action', text: "（舉起手中的紅酒瓶）這鑰匙看起來有點髒，幫你洗洗。", visual: "高高舉起酒瓶，瓶口對準 Leo 的頭頂，動作優雅得像在倒香檳塔。" },
              vicky: { type: 'thought', text: "來了來了！大場面！紅酒瀑布！", visual: "屏住呼吸，確保畫面不手抖。" },
              gordon: { type: 'dialogue', text: "住手！！！那瓶是 2015 年的！！！", visual: "看著 Claire 手中的酒瓶，發出了比剛才更淒厲的慘叫。" }
            },
            {
              time: 180,
              leo: { type: 'visual', text: "（眼前一片血紅）", visual: "紅酒順著頭髮淋下，流進眼睛和嘴巴，視線變得模糊且帶著葡萄味。" },
              mina: { type: 'thought', text: "活該！...但為什麼心還是好痛...", visual: "透過指縫看到 Leo 狼狽的樣子，哭笑不得。" },
              claire: { type: 'dialogue', text: "這才是你該有的樣子。垃圾就該待在垃圾桶裡。", visual: "將空酒瓶重重放在桌上，發出「咚」的一聲，像法官落槌。" },
              vicky: { type: 'dialogue', text: "完勝！正宮完勝！今天的直播斗內要爆了！", visual: "對著鏡頭比了個勝利手勢，背景是滿頭紅酒的 Leo。" },
              gordon: { type: 'dialogue', text: "全都給我滾出去！！！永遠別再來了！！！", visual: "揮舞著巨大的胡椒研磨棒，像驅魔一樣指著門口。" }
            },

            // --- 第四分鐘 (181-240s) ---
            {
              time: 195,
              leo: { type: 'dialogue', text: "Gordon... 多少錢... 我賠，記我帳上...", visual: "一邊擦著眼睛裡的紅酒，一邊狼狽地看向氣炸的主廚。" },
              mina: { type: 'thought', text: "天啊，那張帳單上的零也太多了吧？好險不是我買單。", visual: "偷偷瞄了一眼主廚手上的帳單，倒抽一口氣，眼淚瞬間止住了。" },
              claire: { type: 'dialogue', text: "記帳？你那張副卡已經被我停了。自己想辦法。", visual: "雙手抱胸，好整以暇地看著 Leo，嘴角帶著一絲嘲弄。" },
              vicky: { type: 'dialogue', text: "哇！這酒瓶要價三萬八？這潑得真是「重金」打造啊！", visual: "把鏡頭對準帳單上的數字，語氣誇張地驚嘆。" },
              gordon: { type: 'dialogue', text: "三萬八是進貨價！加上清潔費、精神損失費，總共六萬！現在付清！", visual: "把帳單拍在桌上，震得餐具哐啷作響。" }
            },
            {
              time: 210,
              leo: { type: 'dialogue', text: "Claire... 妳也有份吧？瓶子是妳砸的... 幫幫忙...", visual: "聲音越來越小，試圖伸手去拉 Claire 的衣角，卻再次被閃開。" },
              mina: { type: 'dialogue', text: "你好意思叫女生付錢？你是男人嗎？", visual: "厭惡地看著 Leo，往 Claire 身邊靠了一步，不知不覺站到了同一陣線。" },
              claire: { type: 'dialogue', text: "瓶子是我買的，我已經付過酒錢了。至於砸在誰頭上，那是消費方式的選擇。", visual: "優雅地聳聳肩，從包裡拿出自己的黑卡晃了晃，又收了回去。" },
              vicky: { type: 'thought', text: "這句『消費方式的選擇』太帥了吧！必須剪成金句短影片！", visual: "對著 Claire 投以崇拜的眼神，默默點了個讚。" },
              gordon: { type: 'dialogue', text: "我管你們誰付！再不拿卡出來，我就報警抓人！", visual: "拿著無線刷卡機逼近 Leo，像拿著手槍一樣指著他。" }
            },
            {
              time: 225,
              leo: { type: 'action', text: "（顫抖著拿出自己的信用卡）拜託... 額度要夠...", visual: "手抖得差點拿不住卡片，小心翼翼地插進刷卡機，閉上眼睛祈禱。" },
              mina: { type: 'thought', text: "Claire 姐姐其實人不錯... 是我太笨了。", visual: "看著 Claire 堅定的側臉，心中產生了一種奇怪的依賴感。" },
              claire: { type: 'thought', text: "這小丫頭眼光真差，不過長得倒挺可愛。算了，當作日行一善。", visual: "感受到 Mina 的視線，轉頭遞給她一張乾淨的面紙。" },
              vicky: { type: 'dialogue', text: "見證奇蹟的時刻！刷得過嗎？還是會... 嗶嗶？", visual: "鏡頭特寫刷卡機的螢幕，全場屏息以待。" },
              gordon: { type: 'action', text: "（盯著螢幕等待連線）快點... 連線中...", visual: "不耐煩地用手指敲著機器邊緣，發出噠噠噠的聲音。" }
            },
            {
              time: 240,
              leo: { type: 'visual', text: "嗶—嗶—（交易拒絕：餘額不足）", visual: "刷卡機發出無情的拒絕聲，螢幕上紅色的「DECLINED」字樣格外刺眼。" },
              mina: { type: 'dialogue', text: "噗... 哈哈哈哈！太丟臉了吧！", visual: "終於忍不住破涕為笑，指著 Leo 笑得彎下腰。" },
              claire: { type: 'dialogue', text: "真是意料之中。連這點錢都沒有，還想學人劈腿？", visual: "冷笑著搖搖頭，轉身拿起包包準備離開。" },
              vicky: { type: 'dialogue', text: "交易失敗！渣男信用破產！今日最佳笑話！", visual: "對著鏡頭大笑，直播間的留言刷屏刷到看不清。" },
              gordon: { type: 'dialogue', text: "沒錢？那就留下來洗碗！洗到這筆帳還清為止！跟我進廚房！", visual: "一把揪住 Leo 的領帶，像拖死狗一樣把他往充滿油煙的廚房拖去。" }
            },
            
            // --- 第五分鐘 (241-300s) ---
            {
              time: 255,
              leo: { type: 'thought', text: "我的勞力士... 上面沾到了什麼？是豬油嗎？這味道洗得掉嗎？", visual: "站在充滿蒸汽的洗碗槽前，袖子被粗魯地捲起，看著堆積如山的髒盤子絕望。" },
              mina: { type: 'dialogue', text: "Claire 姐姐，謝謝妳剛剛幫我... 那個熔岩蛋糕看起來好好吃。", visual: "坐在 Claire 對面，眼睛紅紅的，但看著甜點的眼神閃閃發光。" },
              claire: { type: 'dialogue', text: "吃吧，甜點是無辜的。至於那個垃圾，就當作是排毒了。", visual: "優雅地切開熔岩蛋糕，巧克力醬流出來，心情從未如此舒暢。" },
              vicky: { type: 'dialogue', text: "家人們！這就是結局！渣男在洗碗，正宮和小三... 喔不，是受害者聯盟在吃下午茶！", visual: "將鏡頭在廚房的慘狀和餐廳的溫馨畫面之間來回切換。" },
              gordon: { type: 'dialogue', text: "那個盤子要刷三遍！三遍！你這個富二代廢物！", visual: "站在 Leo 身後，像軍隊教官一樣對著他的耳朵大吼。" }
            },
            {
              time: 270,
              leo: { type: 'action', text: "（手滑打破了一個盤子）匡啷！", visual: "盤子從沾滿泡沫的手中滑落，在地上摔得粉碎。" },
              mina: { type: 'dialogue', text: "真的好好吃喔！姐姐，我們加個 IG 好不好？", visual: "嘴邊沾著巧克力醬，拿著手機湊近 Claire，完全忘記了 Leo 的存在。" },
              claire: { type: 'dialogue', text: "可以啊。以後看男人眼光準一點，這種貨色就別撿了。", visual: "拿出手機掃了 Mina 的 QR Code，嘴角露出一抹真心的微笑。" },
              vicky: { type: 'thought', text: "這反轉太神了！訂閱數破十萬了！這波賺翻了！", visual: "看著手機後台不斷跳出的訂閱通知，笑得合不攏嘴。" },
              gordon: { type: 'dialogue', text: "那是限量的骨瓷盤！加五千！現在欠債六萬五了！", visual: "聽到破碎聲，血管差點爆開，在帳單上又狠狠記上一筆。" }
            },
            {
              time: 285,
              leo: { type: 'dialogue', text: "我賠！我都賠！讓我打個電話跟我媽拿錢...", visual: "崩潰地坐在滿是泡沫和碎片的地板上，試圖用濕漉漉的手掏手機。" },
              mina: { type: 'thought', text: "突然覺得他好可憐... 喔不，是好可笑。", visual: "遠遠聽到廚房傳來的哀嚎，心裡最後一絲留戀也煙消雲散。" },
              claire: { type: 'thought', text: "這才是我要的週末。解決了麻煩，還認識了個有趣的小妹妹。", visual: "喝完最後一口紅酒，享受著此刻的平靜。" },
              vicky: { type: 'dialogue', text: "好的各位！今天的直播就到這裡！記得按讚訂閱分享，我們下次修羅場見！", visual: "對著鏡頭做出招牌飛吻動作，準備收工。" },
              gordon: { type: 'action', text: "（搶走 Leo 的手機）沒洗完不准打電話！繼續洗！", visual: "無情地沒收了通訊工具，指著另一堆剛收進來的髒鍋子。" }
            },
            {
              time: 300,
              leo: { type: 'visual', text: "（看著永無止盡的髒盤子，流下了悔恨的淚水）", visual: "視線模糊，分不清臉上是洗碗水還是淚水，背景是 Gordon 的怒吼聲。" },
              mina: { type: 'action', text: "（按下封鎖鍵）再見，前男友。", visual: "手機螢幕上顯示「已封鎖 Leo」，手指輕快地按下了確認。" },
              claire: { type: 'dialogue', text: "Vicky，幫我們拍張照吧。慶祝重生。", visual: "舉起酒杯，拉著 Mina 靠近自己，對著 Vicky 的鏡頭微笑。" },
              vicky: { type: 'dialogue', text: "來囉！三、二、一！西瓜甜不甜～", visual: "按下快門，將這個荒謬又完美的夜晚定格。" },
              gordon: { type: 'thought', text: "哼，至少這兩個女人懂得品味甜點。至於那個洗碗工... 明天叫他刷馬桶。", visual: "看著外場和諧的氣氛，怒氣稍微消了一些，轉身繼續監督 Leo。" }
            }
          ]
        };

        const getContentAtTime = (time, charId) => {
          const events = scriptData.timeline.filter(t => t.time <= time);
          if (events.length === 0) return { type: 'wait', text: '...', visual: '...' };
          const currentEvent = events[events.length - 1];
          return currentEvent[charId] || { type: 'wait', text: '...', visual: '...' };
        };

        const getVoiceSettings = (charId) => {
          switch (charId) {
            case 'leo': return { pitch: 0.9, rate: 0.9 };
            case 'claire': return { pitch: 1.0, rate: 1.0 };
            case 'mina': return { pitch: 1.3, rate: 1.1 };
            case 'vicky': return { pitch: 1.1, rate: 1.05 };
            case 'gordon': return { pitch: 0.7, rate: 1.3 };
            default: return { pitch: 1.0, rate: 1.0 };
          }
        };

        // --- MiniMap 元件 ---
        const MiniMap = ({ activeChar, onSelect }) => {
          return (
            <div className="absolute top-4 right-4 w-40 h-32 md:w-56 md:h-48 bg-slate-800/90 rounded-xl shadow-2xl border border-slate-600 overflow-hidden backdrop-blur-sm z-50">
              {/* 地圖標題 */}
              <div className="absolute top-1 left-2 text-[10px] md:text-xs text-slate-400 font-bold flex items-center gap-1">
                 <MapIcon size={10} /> 餐廳配置圖
              </div>

              {/* 區域標示 */}
              <div className="absolute top-0 right-0 w-1/3 h-1/3 border-l border-b border-slate-600 bg-orange-900/20 flex items-center justify-center">
                <span className="text-[8px] md:text-[10px] text-orange-400 opacity-50">廚房</span>
              </div>
              <div className="absolute bottom-4 left-4 w-8 h-8 md:w-12 md:h-12 border border-slate-600 rounded-full flex items-center justify-center bg-slate-700/30">
                <span className="text-[8px] text-slate-500">T5</span>
              </div>
              <div className="absolute top-1/3 left-1/3 w-10 h-10 md:w-16 md:h-16 border border-slate-600 rounded-lg flex items-center justify-center bg-slate-700/30 transform rotate-12">
                <span className="text-[8px] text-slate-500">T3</span>
              </div>
              <div className="absolute bottom-2 right-2 text-[8px] text-slate-600">Entrance</div>

              {/* 角色點位 */}
              {scriptData.characters.map((char) => (
                <button
                  key={char.id}
                  onClick={(e) => { e.stopPropagation(); onSelect(char.id); }}
                  className={`absolute w-6 h-6 md:w-8 md:h-8 rounded-full border-2 transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 flex items-center justify-center
                    ${activeChar === char.id 
                      ? `${char.color} z-20 scale-125 shadow-[0_0_10px_rgba(255,255,255,0.8)]` 
                      : 'bg-slate-600 border-slate-500 opacity-80 hover:scale-110 hover:z-10 hover:opacity-100'}`}
                  style={{ top: char.mapPos.top, left: char.mapPos.left }}
                  title={`切換到 ${char.name}`}
                >
                  <div className="w-full h-full rounded-full overflow-hidden">
                    <img 
                      src={char.imgFile}
                      alt={char.name}
                      className="w-full h-full object-cover"
                      onError={(e) => {
                        const fallback = `https://loremflickr.com/50/50/${char.keyword}?lock=${char.lockId}`;
                        if (!e.target.src.includes('loremflickr.com')) {
                          e.target.src = fallback;
                        } else {
                          e.target.style.display = 'none'; // 圖片掛了就不顯示，只顯示背景色
                        }
                      }}
                    />
                  </div>
                  {/* 當前視角指示箭頭 (僅 Active 顯示) */}
                  {activeChar === char.id && (
                    <div className="absolute -bottom-1 w-2 h-2 bg-white transform rotate-45 border-r border-b border-slate-300"></div>
                  )}
                </button>
              ))}
            </div>
          );
        };

        const App = () => {
          const [currentTime, setCurrentTime] = React.useState(0);
          const [isPlaying, setIsPlaying] = React.useState(false);
          const [activeChar, setActiveChar] = React.useState('leo');
          const [isMuted, setIsMuted] = React.useState(true);
          const timerRef = React.useRef(null);
          
          React.useEffect(() => {
            if (isPlaying) {
              timerRef.current = setInterval(() => {
                setCurrentTime(prev => {
                  if (prev >= scriptData.meta.duration) {
                    setIsPlaying(false);
                    return prev;
                  }
                  return prev + 1;
                });
              }, 1000);
            } else {
              clearInterval(timerRef.current);
            }
            return () => clearInterval(timerRef.current);
          }, [isPlaying]);

          const currentContent = getContentAtTime(currentTime, activeChar);
          const activeCharData = scriptData.characters.find(c => c.id === activeChar);

          React.useEffect(() => {
            if (isMuted || !currentContent.text) {
              window.speechSynthesis.cancel();
              return;
            }

            window.speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(currentContent.text);
            utterance.lang = 'zh-TW';
            
            const settings = getVoiceSettings(activeChar);
            utterance.pitch = settings.pitch;
            utterance.rate = settings.rate;
            
            window.speechSynthesis.speak(utterance);

            return () => {
              window.speechSynthesis.cancel();
            };
          }, [currentContent.text, activeChar, isMuted]);

          const formatTime = (seconds) => {
            const startHour = 19;
            const startMinute = 30;
            const totalSeconds = startHour * 3600 + startMinute * 60 + seconds;
            
            const h = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
            const s = (totalSeconds % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
          };

          return (
            <div className="flex flex-col h-screen bg-slate-50 font-sans text-slate-800">
              <header className="bg-slate-900 text-white p-4 shadow-lg flex justify-between items-center z-10 shrink-0">
                {/* Left: Title */}
                <div className="font-bold text-lg md:text-xl tracking-widest text-slate-100 flex items-center gap-2">
                   <span className="text-yellow-500">❚</span> {scriptData.meta.title}
                </div>
                
                {/* Right: Clock */}
                <div className="flex items-center gap-3">
                  <div className="text-xl md:text-3xl font-mono font-bold tracking-wider">
                    {formatTime(currentTime)}
                  </div>
                  <Clock className="w-6 h-6 text-red-400 animate-pulse" />
                </div>
              </header>

              <main className="flex-1 overflow-hidden relative flex flex-col md:flex-row">
                
                <div className={`flex-1 p-4 md:p-8 flex flex-col justify-center items-center transition-colors duration-500 ${activeCharData.color} bg-opacity-20 overflow-y-auto relative`}>
                   
                   {/* 插入小地圖 (右上角) */}
                   <MiniMap activeChar={activeChar} onSelect={setActiveChar} />

                   <div className="max-w-3xl w-full py-4 mt-8 md:mt-0"> {/* mt-8 for mobile spacing */}
                      <div className="mb-4 uppercase tracking-widest text-xs font-bold text-slate-400 flex justify-between items-center">
                        <span>目前視角 (Current Perspective)</span>
                        {isMuted ? null : <span className="text-blue-500 flex items-center gap-1 animate-pulse"><Volume2 size={14}/> 語音播放中</span>}
                      </div>
                      
                      <div className="flex items-center gap-4 mb-6 md:mb-8">
                        {/* 主視角頭像 */}
                        <div className={`w-20 h-20 md:w-24 md:h-24 rounded-full ${activeCharData.color} text-slate-700 shadow-lg ring-4 ring-white overflow-hidden flex items-center justify-center`}>
                          <img 
                            src={activeCharData.imgFile}
                            alt={activeCharData.name}
                            className="w-full h-full object-cover"
                            onError={(e) => {
                              // 備用圖片 (LoremFlickr)
                              const fallback = `https://loremflickr.com/200/200/${activeCharData.keyword}?lock=${activeCharData.lockId}`;
                              // 避免無限迴圈
                              if (!e.target.src.includes('loremflickr.com')) {
                                e.target.src = fallback;
                              } else {
                                e.target.style.display = 'none';
                              }
                            }}
                          />
                        </div>
                        <div>
                          <h2 className="text-xl md:text-3xl font-bold">{activeCharData.name}</h2>
                          <span className="text-slate-600 font-medium text-sm md:text-base bg-white/50 px-2 py-0.5 rounded">{activeCharData.role}</span>
                        </div>
                      </div>

                      <div className="mb-6 md:mb-8 p-5 md:p-6 bg-white/80 rounded-lg shadow-sm backdrop-blur-md border-l-4 border-slate-500">
                        <div className="flex items-center gap-2 mb-2 text-slate-400">
                           <div className="w-2 h-2 rounded-full bg-slate-400"></div>
                           <span className="text-xs font-bold">EYES (所見畫面)</span>
                        </div>
                        <p className="text-base md:text-xl italic text-slate-700 leading-relaxed serif">
                          "{currentContent.visual}"
                        </p>
                      </div>

                      <div className={`p-6 md:p-8 rounded-xl shadow-xl bg-white transition-all duration-300 transform 
                        ${currentContent.type === 'thought' ? 'border-dashed border-2 border-slate-400' : 'border-solid border-l-8 border-slate-800'}`}>
                        <span className={`text-xs font-bold block mb-3 uppercase flex items-center gap-2
                          ${currentContent.type === 'thought' ? 'text-blue-600' : 'text-red-600'}`}>
                          {currentContent.type === 'thought' ? <span><Zap className="inline w-4 h-4 mr-1"/> MIND (內心獨白)</span> : <span><MessageCircle className="inline w-4 h-4 mr-1"/> MOUTH (對話)</span>}
                        </span>
                        <p className="text-xl md:text-4xl font-bold leading-relaxed text-slate-900">
                          {currentContent.text}
                        </p>
                      </div>
                   </div>
                </div>

                <div className="bg-white border-t md:border-t-0 md:border-l border-slate-200 p-2 md:p-4 md:w-72 flex md:flex-col gap-2 md:gap-3 overflow-x-auto md:overflow-y-auto shrink-0 safe-area-bottom">
                  <div className="hidden md:block text-xs font-bold text-slate-400 uppercase mb-2">
                    切換視角 (Switch View)
                  </div>
                  {scriptData.characters.map(char => (
                    <button
                      key={char.id}
                      onClick={() => setActiveChar(char.id)}
                      className={`flex flex-col md:flex-row items-center gap-2 md:gap-3 p-2 md:p-3 rounded-xl min-w-[80px] md:w-full transition-all duration-200 text-left relative overflow-hidden
                        ${activeChar === char.id 
                          ? `${char.color} ring-2 ring-offset-2 ring-slate-800 scale-100 md:scale-105 shadow-md` 
                          : 'hover:bg-slate-50 opacity-70 hover:opacity-100 grayscale hover:grayscale-0'
                        }`}
                    >
                      <div className="w-10 h-10 md:w-12 md:h-12 rounded-full bg-white shadow-sm flex items-center justify-center shrink-0 overflow-hidden">
                         <img 
                            src={char.imgFile}
                            alt={char.name}
                            className="w-full h-full object-cover"
                            onError={(e) => {
                              const fallback = `https://loremflickr.com/150/150/${char.keyword}?lock=${char.lockId}`;
                              if (!e.target.src.includes('loremflickr.com')) {
                                e.target.src = fallback;
                              } else {
                                e.target.style.display = 'none';
                              }
                            }}
                          />
                      </div>
                      <div className="flex-1 min-w-0 text-center md:text-left">
                        <div className="font-bold text-xs md:text-base truncate">{char.name}</div>
                        <div className="text-[10px] md:text-xs text-slate-500 truncate">{char.role}</div>
                      </div>
                    </button>
                  ))}
                </div>
              </main>

              <footer className="bg-white border-t border-slate-200 p-3 md:p-4 pb-6 safe-area-bottom shrink-0">
                <div className="max-w-4xl mx-auto space-y-3">
                  <input
                    type="range"
                    min="0"
                    max={scriptData.meta.duration}
                    value={currentTime}
                    onChange={(e) => {
                      setCurrentTime(parseInt(e.target.value));
                      setIsPlaying(false);
                    }}
                    className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-900"
                  />
                  
                  <div className="flex justify-center items-center gap-4 md:gap-8">
                    <button 
                      onClick={() => {
                        setCurrentTime(Math.max(0, currentTime - 5));
                        setIsPlaying(false);
                      }}
                      className="p-2 text-slate-400 hover:text-slate-800 transition-colors"
                    >
                      <SkipBack className="w-6 h-6" />
                    </button>
                    
                    <button
                      onClick={() => setIsPlaying(!isPlaying)}
                      className="w-14 h-14 bg-slate-900 text-white rounded-full flex items-center justify-center hover:bg-slate-700 transition-transform active:scale-95 shadow-xl ring-4 ring-slate-100"
                    >
                      {isPlaying ? <Pause className="w-6 h-6" /> : <Play className="w-6 h-6 ml-1" />}
                    </button>

                    <button 
                      onClick={() => {
                        setCurrentTime(Math.min(scriptData.meta.duration, currentTime + 5));
                        setIsPlaying(false);
                      }}
                      className="p-2 text-slate-400 hover:text-slate-800 transition-colors"
                    >
                      <SkipForward className="w-6 h-6" />
                    </button>

                    <button 
                      onClick={() => setIsMuted(!isMuted)}
                      className={`p-3 rounded-full transition-all ${isMuted ? 'bg-slate-100 text-slate-400 hover:bg-slate-200' : 'bg-blue-100 text-blue-600 hover:bg-blue-200'}`}
                      title={isMuted ? "開啟內心獨白語音" : "關閉語音"}
                    >
                      {isMuted ? <VolumeX className="w-5 h-5" /> : <Volume2 className="w-5 h-5" />}
                    </button>
                  </div>
                </div>
              </footer>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>